
/*
 This file was generated by wCMFGenerator 2.6.1.0016 from model/requirements.xmi on 02.09.08 21:48. 
  Manual modifications should be placed inside the protected regions.
   developer: Giuseppe Platania
   Version: 1.0
   Class: class.ChiNode.js
   Description: 
  */
  
cwm.figure.ChiNode = function(label, oid, parentoids, childoids){

	cwm.figure.RectFigure.call(this, "ChiNode", label, oid, parentoids, childoids);
}

cwm.figure.ChiNode.prototype = new uwm.figure.RectFigure;

cwm.figure.ChiNode.prototype.type = "cwm.figure.ChiNode";

cwm.figure.ChiNode.prototype.getGrid = function(store) {
	return new Ext.grid.GridPanel({
	id: "GridChiNode",
		iconCls: "FigureGraphic FigureChiNode",
		layout: "fit",
					columns: [{
						header: "ChiNode",
						dataIndex: "Name",
						sortable: true
					}, {
					header: "parentoids",
					dataIndex: "parentoids",
					hidden: true,
					hideable: false
				}, {
					header: "childoids",
					dataIndex: "childoids",
					hidden: true,
					hideable: false
				}],
					store: store,
					enableDragDrop: true,
					selModel: new Ext.grid.RowSelectionModel({
						singleSelect: true
					}),
					ddGroup: "gridDDGroup",
					uwmClassName: "ChiNode",
					listeners: {
								cellclick: function(grid, rowIndex, columnIndex, e) {
								uwm.showProperties(grid.uwmClassName, grid.getStore().getAt(rowIndex).id);
								},
								cellcontextmenu: function(grid, rowIndex, columnIndex, e){
								var node = grid.getStore().getAt(rowIndex);
				
							var contextMenu = new Ext.menu.Menu({
								items: [new Ext.menu.Item({
									text: "Show in diagram",
									handler: function(item, e){
										var oid = node.id;							
										uwm.showInDiagram(oid);
															},
						disabled: !uwm.getByOid(node.id)
					}), new Ext.menu.Item({
						text: "Show in Tree",
						handler: function(item, e){
							var oid = node.id;
							
							uwm.showInTree(oid);
						}
					}), "-", {
						text: "Delete from model",
						handler: function(){
							var record = grid.getStore().getAt(rowIndex);
							
							grid.getStore().remove(record);
							uwm.deleteFigureFromModel(record.id);
						}
					}]
				});
				
				contextMenu.showAt(e.getXY());				
				e.stopPropagation();				
				return false;
			}
		}
	});
}


cwm.figure.ChiNode.prototype.getStore = function(){
	return new Ext.data.Store({
		url: uwm.config.jsonUrl,
		baseParams: {
			sid: uwm.data.sid,
			usr_action: "list",
			response_format: "JSON",
			type: "ChiNode"
		},
		reader: new Ext.data.JsonReader({
			totalProperty: "totalCount",
			root: "objects",
			id: "oid",
			fields: [{
				name: "Name",
				mapping: "values[1].Name"
			}, {
				name: "parentoids",
				mapping: "properties.parentoids"
			}, {
				name: "childoids",
				mapping: "properties.childoids"
			}]
		})
	});
}

cwm.figure.ChiNode.prototype.showEdit = function(parentComponent, oid){

	Ext.form.Field.prototype.msgTarget = 'side';
	var listeners = {
					"change": function(field, newValue, oldValue){
																	uwm.fieldChanged(field, newValue, oldValue, oid);
																}
					};
	var htmlListeners = {
						"sync": function(field, html){
						field.contentChanged = true;
						},
						"beforedestroy": function(field){
														if (field.contentChanged) {
																				uwm.fieldChanged(field, field.getValue(), null, oid);
																					}
														}
						};	
	var form = new Ext.FormPanel({	
		oid: oid,
		labelWidth: 90,	
		frame: true,
		labelAlign: "top",
		title: 'ChiNode Edit View',
		autoScroll: true,
		defaults: {
			width: 222
		},
		defaultType: 'textfield',
		items: [
				
			{	
			fieldLabel: 'display_value',
	        name: 'display_value',
	        
	         inputType:'textfield',
	        listeners: listeners 
	        }
,

			{	
			fieldLabel: 'parent_order',
	        name: 'parent_order',
	        
	         inputType:'textfield',
	        listeners: listeners 
	        }
,

			{	
			fieldLabel: 'child_order',
	        name: 'child_order',
	        
	         inputType:'textfield',
	        listeners: listeners 
	        }
,

			{	
			fieldLabel: 'pk_name',
	        name: 'pk_name',
	        
	         inputType:'textfield',
	        listeners: listeners 
	        }
,

			{	
			fieldLabel: 'is_searchable',
	        name: 'is_searchable',
	        
	         //TODO check this in model originally was in  select#fix:true|false format. supposing is a combobox.
new Ext.form.ComboBox({
			fieldLabel: 'Value_Name',
			name: 'Value_Name',
			store: new Ext.data.Store({
				url: uwm.config.jsonUrl,
				method: "POST",
				baseParams: {
					sid: uwm.data.sid,
					response_format: "JSON",
					usr_action: "listbox",
					// TODO extract the entity type manually
					type: ""
				},
				reader: new Ext.data.JsonReader({
					root: "objects",
					totalPorperty: "totalCount",
					id: "key"
				}, [{
					name: "key",
					mapping: "key"
				}, {
					name: "val",
					mapping: "val"
				}])
			}),
			displayField: 'val',
			valueField: 'key',
			mode: "remote",
			triggerAction: 'all',
			editable: false,
			listeners: listeners
		}), 

	        listeners: listeners 
	        }
,

			{	
			fieldLabel: 'orderby',
	        name: 'orderby',
	        
	         inputType:'textfield',
	        listeners: listeners 
	        }
,

			{	
			fieldLabel: 'is_soap',
	        name: 'is_soap',
	        
	         //TODO check this in model originally was in  select#fix:true|false format. supposing is a combobox.
new Ext.form.ComboBox({
			fieldLabel: 'Value_Name',
			name: 'Value_Name',
			store: new Ext.data.Store({
				url: uwm.config.jsonUrl,
				method: "POST",
				baseParams: {
					sid: uwm.data.sid,
					response_format: "JSON",
					usr_action: "listbox",
					// TODO extract the entity type manually
					type: ""
				},
				reader: new Ext.data.JsonReader({
					root: "objects",
					totalPorperty: "totalCount",
					id: "key"
				}, [{
					name: "key",
					mapping: "key"
				}, {
					name: "val",
					mapping: "val"
				}])
			}),
			displayField: 'val',
			valueField: 'key',
			mode: "remote",
			triggerAction: 'all',
			editable: false,
			listeners: listeners
		}), 

	        listeners: listeners 
	        }
,

			{	
			fieldLabel: 'initparams',
	        name: 'initparams',
	        
	         inputType:'textfield',
	        listeners: listeners 
	        }
,

			{	
			fieldLabel: 'Alias',
	        name: 'Alias',
	        
	         inputType:'textfield',
	        listeners: listeners 
	        }
,

			{	
			fieldLabel: 'Version',
	        name: 'Version',
	        
	         inputType:'textfield',
	        listeners: listeners 
	        }
,

			{	
			fieldLabel: 'Name',
	        name: 'Name',
	        
	         inputType:'textfield',
	        listeners: listeners 
	        }
,

			// TODO check this manually
			new Ext.form.HtmlEditor({
			fieldLabel: 'Notes',
			name: 'Notes',
			enableAlignments: false,
			enableColors: false,
			enableFont: false,
			enableFontSize: false,
			enableLinks: false,
			enableSourceEdit: false,			
			listeners: htmlListeners
		}),
,

			{	
			fieldLabel: 'created',
	        name: 'created',
	        readOnly:true,
	         inputType:'textfield',
	        listeners: listeners 
	        }
,

			{	
			fieldLabel: 'creator',
	        name: 'creator',
	        readOnly:true,
	         inputType:'textfield',
	        listeners: listeners 
	        }
,

			{	
			fieldLabel: 'last_editor',
	        name: 'last_editor',
	        readOnly:true,
	         inputType:'textfield',
	        listeners: listeners 
	        }
,

			{	
			fieldLabel: 'modified',
	        name: 'modified',
	        readOnly:true,
	         inputType:'textfield',
	        listeners: listeners 
	        }


			]
	});
	
	parentComponent.add(form);
	parentComponent.doLayout();


	uwm.jsonRequest({
		usr_action: "display",
		oid: oid,
		depth: 0,
		omitMetaData: true
		}, 
		"Loading properties", function(data){
		var realForm = form.getForm();			
			
			realForm.findField("display_value").setValue(data.node.values[1].display_value);
			realForm.findField("parent_order").setValue(data.node.values[1].parent_order);
			realForm.findField("child_order").setValue(data.node.values[1].child_order);
			realForm.findField("pk_name").setValue(data.node.values[1].pk_name);
			realForm.findField("is_searchable").setValue(data.node.values[1].is_searchable);
			realForm.findField("orderby").setValue(data.node.values[1].orderby);
			realForm.findField("is_soap").setValue(data.node.values[1].is_soap);
			realForm.findField("initparams").setValue(data.node.values[1].initparams);
			realForm.findField("Alias").setValue(data.node.values[1].Alias);
			realForm.findField("Version").setValue(data.node.values[1].Version);
			realForm.findField("Name").setValue(data.node.values[1].Name);
			realForm.findField("Notes").setValue(data.node.values[1].Notes);
			realForm.findField("created").setValue(data.node.values[1].created);
			realForm.findField("creator").setValue(data.node.values[1].creator);
			realForm.findField("last_editor").setValue(data.node.values[1].last_editor);
			realForm.findField("modified").setValue(data.node.values[1].modified);		
	});
};
cwm.figure.ChiNode.prototype.getConstraints = function() {
	return {
				
		ChiController: {
			label: "depends on",
			inverse: false,
			sourceMaxConns: -1,
			targetMaxConns: -1,
			relationship:"parent"
		},
		ChiValue: {
			label: "defines",
			inverse: true,
			ConnectionType: "aggregation",
			sourceMaxConns: -1,
			targetMaxConns: -1,
			relationship:"child"
		}
		
	};
}
